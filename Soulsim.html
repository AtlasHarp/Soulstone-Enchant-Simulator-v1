<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Soulstone Enchant Simulator</title>
<style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; padding:20px }
    select, button, input { margin:5px; padding:5px }
    .stone { border:1px solid #444; padding:15px; margin-bottom:15px }
    .log { max-height:300px; overflow-y:auto; background:#000; padding:10px; font-size:14px }
    .buff { color:#4caf50 }
    .curse { color:#f44336 }
    .waste { color:#ff9800 }
    .stop { color:#03a9f4 }
</style>
</head>
<body>

<h1>Soulstone Enchant Simulator</h1>

<div class="stone">
    <h3>Select Buffs</h3>
    <select id="buff1"></select>
    <select id="buff2"></select>
    <select id="buff3"></select>

    <h3>Select Curse</h3>
    <select id="curse"></select>

    <h3>Initial Enchant Chance</h3>
    <input type="number" id="chance" value="75" min="25" max="75"> %

    <br><br>
    <button onclick="enchant()">Enchant Once</button>
    <button onclick="autoEnchant()">Auto Enchant</button>
    <button onclick="resetSim()">Reset</button>
</div>

<h3>Status</h3>
<div id="status"></div>

<h3>Log</h3>
<div class="log" id="log"></div>

<script>
const MAX_BUFF = 10;
const MAX_ROLLS = 40;

const buffs = [
"Vengeance","Juggernaut","Ability Master","Hexed","Adrenaline",
"Precision","Blunt Force","Bloodlust","Preemptive Strike","Tenacity",
"Fortitude","Merciless","Heavy Armor","Emergency Rescue","Bountiful","Haste"
];

const curses = [
"Power Curse","Speed Curse","Defence Curse","Crit Curse"
];

const buffData = {};
buffs.forEach(b => buffData[b] = 0);

let curseStacks = 0;
let chance = 75;
let rollsUsed = 0;

function populate() {
    ["buff1","buff2","buff3"].forEach(id => {
        const s = document.getElementById(id);
        buffs.forEach(b => s.add(new Option(b,b)));
    });
    const c = document.getElementById("curse");
    curses.forEach(b => c.add(new Option(b,b)));
}
populate();

function log(msg, cls="") {
    const div = document.getElementById("log");
    div.innerHTML += `<div class="${cls}">${msg}</div>`;
    div.scrollTop = div.scrollHeight;
}

function rollSuccess() {
    return Math.random() * 100 < chance;
}

function enchant() {
    if (rollsUsed >= MAX_ROLLS) {
        log("âŒ No rolls remaining â€” enchanting stopped", "stop");
        return;
    }

    rollsUsed++;

    const targets = [
        document.getElementById("buff1").value,
        document.getElementById("buff2").value,
        document.getElementById("buff3").value,
        document.getElementById("curse").value
    ];

    const target = targets[Math.floor(Math.random() * targets.length)];
    const success = rollSuccess();

    if (success) {
        chance = Math.max(25, chance - 10);

        if (buffData[target] !== undefined) {
            if (buffData[target] >= MAX_BUFF) {
                log(`SUCCESS â†’ ${target} already maxed (wasted)`, "waste");
            } else {
                buffData[target]++;
                log(`SUCCESS â†’ ${target} +1 (${buffData[target]})`, "buff");
            }
        } else {
            curseStacks++;
            log(`âš  CURSE ENCHANTED â†’ ${target} (${curseStacks})`, "curse");
        }
    } else {
        chance = Math.min(75, chance + 10);
        log(`Fail â†’ Chance increased to ${chance}%`);
    }

    if (rollsUsed === MAX_ROLLS) {
        log("ðŸ›‘ Roll limit reached (40). Finalized.", "stop");
    }

    update();
}

function tier(n) {
    if (n >= 10) return "T2 (MAX)";
    if (n >= 5) return "T1";
    return "-";
}

function update() {
    let html = `
        <b>Rolls Used:</b> ${rollsUsed} / ${MAX_ROLLS}<br>
        <b>Enchant Chance:</b> ${chance}%<br><br>
    `;

    for (let b in buffData) {
        if (buffData[b] > 0)
            html += `${b}: ${buffData[b]} / ${MAX_BUFF} (${tier(buffData[b])})<br>`;
    }

    html += `<br><b>Curse Stacks:</b> ${curseStacks}`;
    document.getElementById("status").innerHTML = html;
}

function autoEnchant() {
    while (rollsUsed < MAX_ROLLS) enchant();
}

function resetSim() {
    for (let b in buffData) buffData[b] = 0;
    curseStacks = 0;
    rollsUsed = 0;
    chance = Number(document.getElementById("chance").value);
    document.getElementById("log").innerHTML = "";
    update();
}

update();
</script>

</body>
</html>
